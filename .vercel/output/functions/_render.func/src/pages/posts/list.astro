---
// src/pages/posts/list.astro
import Layout from '../../layouts/Layout.astro';

const response = await fetch("https://xs688150.xsrv.jp/headless/graphql", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
      query GetPosts {
        posts {
          nodes {
            id
            title
            slug  # リンクに使うので必須
            date
            featuredImage {
              node {
                sourceUrl
                altText
              }
            }
          }
        }
      }
    `,
  }),
});

const { data } = await response.json();
const posts = data.posts.nodes;
---

<Layout title="記事一覧">
    <main>
      <h1 class="c-title">記事一覧</h1>

      <div class="p-post-list">
        {posts.map((post) => (
          <article class="p-post-card">
            {/* 【ここを修正】リンク先を post.id から post.slug に変更 */}
            <a href={`/posts/${post.slug}`}>
              <div class="p-post-card__img">
                {post.featuredImage ? (
                  <img 
                    src={post.featuredImage.node.sourceUrl} 
                    alt={post.featuredImage.node.altText || post.title} 
                  />
                ) : (
                  <div class="c-no-image">No Image</div>
                )}
              </div>
              <div class="p-post-card__content">
                <h2 class="p-post-card__title">{post.title}</h2>
                <time class="p-post-card__date">{new Date(post.date).toLocaleDateString()}</time>
              </div>
            </a>
          </article>
        ))}
      </div>
    </main>
</Layout>

<style lang="scss">
.p-post-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 40px;
  padding: 40px;

  .p-post-card {
    border: 1px solid #eee;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    text-decoration: none; // リンクの下線を消す
    color: inherit;
    transition: transform 0.2s;

    &:hover {
      transform: translateY(-5px);
    }
    
    &__img img {
      width: 100%;
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }

    &__content {
      padding: 20px;
    }

    &__title {
      font-size: 1.25rem;
      margin-bottom: 10px;
      color: #333;
    }

    &__date {
      font-size: 0.9rem;
      color: #888;
    }
  }
}
.c-no-image {
  aspect-ratio: 16 / 9;
  background: #f0f0f0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ccc;
}
</style>