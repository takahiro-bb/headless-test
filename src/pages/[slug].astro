---
// src/pages/[slug].astro
export const prerender = false;

// インポートは一番上にまとめるのがルール！
import Layout from '../layouts/Layout.astro';

const { slug } = Astro.params;

const response = await fetch(import.meta.env.WORDPRESS_API_URL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
      query GetPageBySlug($id: ID!) {
        page(id: $id, idType: URI) {
          title
          content
        }
      }
    `,
    variables: { id: slug }
  }),
});

const { data } = await response.json();
const page = data?.page;

if (!page) {
  return Astro.redirect('/404');
}
---

{/* 修正ポイント：titleの渡し方を変更 */}
<Layout title={`TOP | ${page.title}`}>
  <main class="l-main">
    <article class="p-page">
      <h1 class="p-page__title">{page.title}</h1>
      <div class="p-page__body" set:html={page.content} />
    </article>
  </main>
</Layout>

<style lang="scss">
.p-page {
  max-width: 1000px;
  margin: 0 auto;
  padding: 80px 20px;
  &__title {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 60px;
  }

  // 本文内のスタイルを当てるなら :global() を活用！
  &__body {
    line-height: 1.8;
    :global(p) { margin-bottom: 1.5em; }
  }
}
</style>