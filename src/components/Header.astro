---
// src/components/Header.astro
const response = await fetch("https://xs688150.xsrv.jp/headless/graphql", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
      query GetMenu {
        menuItems(where: {location: PRIMARY}) {
          nodes {
            label
            uri
            connectedObject {
              __typename
              ... on Post {
                slug
              }
              ... on Page {
                slug
              }
            }
          }
        }
      }
    `,
  }),
});

const json = await response.json();
const menuItems = json.data?.menuItems?.nodes || [];
---

<header class="l-header">
  <div class="l-header__inner">
    <a href="/" class="l-header__logo">My Headless Site</a>

    <nav>
      <ul class="p-gnav">
        {menuItems.map((item) => {
          const type = item.connectedObject?.__typename;
          const slug = item.connectedObject?.slug;
          
          let href = "";
          if (type === 'Post') {
            href = `/posts/${slug}`;
          } else if (type === 'Page') {
            href = `/${slug}`;
          } else {
            // カスタムリンク（listなど）の場合は、WordPressで設定したuriをそのまま使う
            // uriが "/list/" のようになるので、適宜ドメインを除去する処理を入れると安全
            href = item.uri.replace('https://xs688150.xsrv.jp/headless', '');
          }

          return (
            <li class="p-gnav__item">
              <a href={href} class="p-gnav__link">{item.label}</a>
            </li>
          );
        })}
      </ul>
    </nav>
  </div>
</header>

<style lang="scss">
.l-header {
  border-bottom: 1px solid #eee;
  &__inner {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
  }
}
.p-gnav {
  display: flex;
  gap: 20px;
  list-style: none;
  &__link {
    text-decoration: none;
    color: #333;
    &:hover { color: #0073aa; }
  }
}
</style>